<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Numero Misterioso</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f2f2f2;
    margin: 0;
    padding: 0;
    text-align: center;
  }

  #top-banner,
  #bottom-banner {
    background: #ccc;
    padding: 10px;
    font-weight: bold;
  }

  #game-container {
    margin: 10px auto 20px;
    max-width: 320px;
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 5px;
    margin-bottom: 10px;
  }

  .cell {
    width: 100%;
    padding-top: 100%; /* quadrata */
    position: relative;
    border: 2px solid #aaa;
    background: white;
    font-size: 24px;
    font-weight: bold;
    box-sizing: border-box;
  }

  .cell div {
    position: absolute;
    top: 0; bottom: 0; left: 0; right: 0;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .active {
    border-color: #000;
  }

  #keyboard {
    max-width: 320px;
    margin: 0 auto 20px auto;
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 5px;
  }

  .key {
    padding: 12px;
    background: #e0e0e0;
    border: 1px solid #888;
    font-size: 18px;
    border-radius: 6px;
    cursor: pointer;
    user-select: none;
  }

  #result-box {
    margin-top: 10px;
    font-size: 18px;
    font-weight: bold;
    word-wrap: break-word;
  }

</style>
</head>
<body>
<div id="top-banner">topbanner</div>

<h2>Numero Misterioso</h2>
<div id="game-container"></div>
<div id="keyboard"></div>
<div id="result-box"></div>
<button id="shareBtn" style="display:none; margin-top:10px; padding:8px 12px; font-size:12px; border-radius:3px; border:none; background:#25D366; color:white; cursor:pointer;">
  üì≤ Condividi su WhatsApp
</button>


<div id="bottom-banner">CONTATTI ‚Ä¢ POLICY ‚Ä¢ INFO</div>

<script>
let level = 1;
let tentativiMax = {1: 5, 2: 4};
let tentativo = 0;
let guess = "";
// DUE NUMERI GIORNALIERI PER LIVELLO 1 E LIVELLO 2
function generate5Digit() {
    let n = "";
    for (let i = 0; i < 5; i++) {
        n += Math.floor(Math.random() * 10);
    }
    return n;
}

function getDailyNumbers() {
    const today = new Date().toISOString().slice(0, 10);

    let savedDay = localStorage.getItem("dailyDay");
    let num1 = localStorage.getItem("dailyNumber1");
    let num2 = localStorage.getItem("dailyNumber2");

    // Nuovo giorno ‚Üí genera 2 nuovi numeri
    if (savedDay !== today || !num1 || !num2) {
        num1 = generate5Digit();
        num2 = generate5Digit();
        localStorage.setItem("dailyDay", today);
        localStorage.setItem("dailyNumber1", num1);
        localStorage.setItem("dailyNumber2", num2);
    }

    return { num1, num2 };
}

let secret1 = null;
let secret2 = null;
let secret = null;   // si inizializza, ma NON si assegna ancora
let gameDate = "";

fetch("https://github.com/pasto360/easygame/numero_giornaliero.php")
  .then(r => r.json())
  .then(data => {
      secret1 = data.num1;
      secret2 = data.num2;
      gameDate = data.date;   // <-- AGGIUNTO
      secret = secret1;

      console.log("Numero del giorno livello 1:", secret1);
      console.log("Numero del giorno livello 2:", secret2);

      buildGrid();
      buildKeyboard();
  });

let gameOver = false;
let activeRow = 0;
let activeCol = 0;

function genSecret() {
  let n = "";
  for (let i = 0; i < 5; i++) n += Math.floor(Math.random() * 10);
  return n;
}

function buildGrid() {
  const container = document.getElementById("game-container");
  container.innerHTML = "";

  for (let r = 0; r < tentativiMax[level]; r++) {
    const row = document.createElement("div");
    row.className = "grid";
    for (let c = 0; c < 5; c++) {
      const cell = document.createElement("div");
      cell.className = "cell";
      cell.id = `cell-${r}-${c}`;
      const inner = document.createElement("div");
      cell.appendChild(inner);
      row.appendChild(cell);
    }
    container.appendChild(row);
  }
  highlightActive();
}

function highlightActive() {
  document.querySelectorAll('.cell').forEach(c => c.classList.remove('active'));
  if (!gameOver) {
    const el = document.getElementById(`cell-${activeRow}-${activeCol}`);
    if (el) el.classList.add('active');
  }
}

function buildKeyboard() {
  const kb = document.getElementById("keyboard");
  kb.innerHTML = "";
  const keys = [0,1,2,3,4,5,6,7,8,9];
  keys.forEach(k => addKey(k));
  addKey("‚å´", "delete");
  addKey("‚èé", "enter");
}

function addKey(label, type="num") {
  const k = document.createElement("button");
  k.className = "key";
  k.textContent = label;
  k.onclick = () => handleKey(type === "num" ? label : type);
  document.getElementById("keyboard").appendChild(k);
}

function handleKey(key) {
  if (gameOver) return;

  if (!isNaN(key)) {
    if (activeCol < 5) {
      document.getElementById(`cell-${activeRow}-${activeCol}`).firstChild.textContent = key;
      guess += key;
      activeCol++;
      highlightActive();
    }
    return;
  }

  if (key === "delete") {
    if (activeCol > 0) {
      activeCol--;
      guess = guess.slice(0, -1);
      document.getElementById(`cell-${activeRow}-${activeCol}`).firstChild.textContent = "";
      highlightActive();
    }
    return;
  }

  if (key === "enter") submitGuess();
}

function submitGuess() {
  if (guess.length < 5) return;
  checkAttempt();

  tentativo++;

  if (guess === secret) {
    endLevelSuccess();
    return;
  }

  if (tentativo >= tentativiMax[level]) {
    endLevelFail();
    return;
  }

  activeRow++;
  activeCol = 0;
  guess = "";
  highlightActive();
}

function checkAttempt() {
  const count = {};
  for (let ch of secret) count[ch] = (count[ch]||0)+1;

  const result = Array(5).fill("red");

  for (let i = 0; i < 5; i++) {
    if (guess[i] === secret[i]) {
      result[i] = "green";
      count[guess[i]]--;
    }
  }

  for (let i = 0; i < 5; i++) {
    if (result[i] !== "green") {
      if (count[guess[i]] > 0) {
        result[i] = "yellow";
        count[guess[i]]--;
      }
    }
  }

  for (let i = 0; i < 5; i++) {
    const cell = document.getElementById(`cell-${activeRow}-${i}`);
    cell.style.background = result[i] === "green" ? "#6aaa64" :
                           result[i] === "yellow" ? "#c9b458" : "#d3d3d3";
  }
}

let resultL1 = null;
let resultL2 = null;

function endLevelSuccess() {
  if (level === 1) {
    resultL1 = tentativo + 1;
    level = 2;
    secret = secret2;
    tentativo = 0;
    guess = "";
    activeRow = 0;
    activeCol = 0;
    buildGrid();
    highlightActive();
  } else {
    resultL2 = tentativo + 1;
    endGame(true);
  }
}

function endLevelFail() {
  if (level === 1) {
    resultL1 = "‚ùå";
    resultL2 = "‚ùå";
    endGame(false);
  } else {
    resultL2 = "‚ùå";
    endGame(false);
  }
}

function endGame(vittoria) {
  gameOver = true;

  const stats = JSON.parse(localStorage.getItem("stats") || "{\"partite\":0,\"vittorie\":0}");
  stats.partite++;
  if (vittoria) stats.vittorie++;
  localStorage.setItem("stats", JSON.stringify(stats));

  const box = document.getElementById("result-box");
  box.innerHTML = `<br><b>Risultato:</b><br>
                 1Ô∏è‚É£-${resultL1} &nbsp;&nbsp; 2Ô∏è‚É£-${resultL2}<br><br>
                 <b>Partite giocate üïπÔ∏è:</b> ${stats.partite}<br>
                 <b>Partite vinte üèÜ:</b> ${stats.vittorie}`;

// WhatsApp
document.getElementById("shareBtn").style.display = "inline-block";
}

buildGrid();
buildKeyboard();
// condivisione:
document.addEventListener("keydown", (e) => {
  if (gameOver) return;

  if (/^[0-9]$/.test(e.key)) {
    handleKey(e.key);
  } else if (e.key === "Backspace") {
    handleKey("delete");
  } else if (e.key === "Enter") {
    handleKey("enter");
  }
});
document.getElementById("shareBtn").onclick = () => {
  if (!resultL1 && !resultL2) return;

  let text = 
    `üìÖ Gioco del ${gameDate}\n` +
    `Risultato:\n` +
    `1Ô∏è‚É£-${resultL1}   (numero: ${secret1})\n` +
    `2Ô∏è‚É£-${resultL2}   (numero: ${secret2})`;

  text = encodeURIComponent(text);
  const url = `https://wa.me/?text=${text}`;
  window.open(url, "_blank");
};


</script>
</body>
</html>


